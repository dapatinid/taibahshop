{
    "sourceFile": "app/Filament/Resources/PorderResource.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1731221668505,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1731263773404,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -363,11 +363,19 @@\n                 TextColumn::make('shipping_method')\n                     ->searchable()\n                     ->sortable(),\n \n-                TextColumn::make('address.fullname')\n-                    ->label('for')\n-                    ->sortable(),\n+                T// TextColumn::make('address.fullname')\n+                //     ->label('for')\n+                //     ->sortable(),\n+                TextColumn::make('address.first_name')\n+                ->label('FName')\n+                ->searchable()\n+                ->sortable(),\n+            TextColumn::make('address.last_name')\n+                ->label('LName')\n+                ->searchable()\n+                ->sortable(),\n                 TextColumn::make('address.phone')\n                     ->label('phone')\n                     ->searchable()\n                     ->sortable(),\n"
                },
                {
                    "date": 1731263783015,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -363,9 +363,9 @@\n                 TextColumn::make('shipping_method')\n                     ->searchable()\n                     ->sortable(),\n \n-                T// TextColumn::make('address.fullname')\n+                // TextColumn::make('address.fullname')\n                 //     ->label('for')\n                 //     ->sortable(),\n                 TextColumn::make('address.first_name')\n                 ->label('FName')\n"
                },
                {
                    "date": 1732191279934,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,260 +58,369 @@\n \n     public static function form(Form $form): Form\n     {\n         return $form\n-            ->schema([\n-                Group::make()->schema([\n-                    Section::make('Order Information')->schema([\n \n-                        Hidden::make('branch_id')\n-                            ->default(fn() => Auth::user()->branch_id)\n-                            ->required(),\n+        ->schema([\n+            Group::make()->schema([\n+                Section::make('Purchase Order Information')->schema([\n \n-                        Hidden::make('created_by')\n-                            ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n-                            // ->disabledOn('edit')\n-                            ->required(),\n+                    Hidden::make('branch_id')\n+                        ->default(fn() => Auth::user()->branch_id)\n+                        ->required(),\n \n-                        Hidden::make('updated_by')\n-                            ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n-                            ->required(),\n+                    Hidden::make('created_by')\n+                        ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n+                        // ->disabledOn('edit')\n+                        ->required(),\n \n-                        TextInput::make('code_tr')\n-                            ->label('No. Transsaction')\n-                            ->default('PUR' . date('YmdHis')) ## Jika ingin menggunakan OrderID otomatis\n-                            ->readOnly()\n-                            ->columnSpan(6),\n+                    Hidden::make('updated_by')\n+                        ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n+                        ->required(),\n \n-                        DateTimePicker::make('date_order')\n-                            ->default(now())\n-                            ->required()\n-                            ->columnSpan(6),\n+                    TextInput::make('code_tr')\n+                        ->label('No. Transsaction')\n+                        ->default('PRD' . date('YmdHis') . '-' . Auth::user()->id) ## Jika ingin menggunakan OrderID otomatis\n+                        ->readOnly()\n+                        ->columnSpan(6),\n \n-                        Select::make('user_id')\n-                            ->label('Supplier')\n-                            ->relationship('user', 'name')\n-                            ->searchable()\n-                            ->preload()\n-                            ->required()\n-                            ->columnSpan(4),\n+                    DateTimePicker::make('date_order')\n+                        ->default(now())\n+                        ->required()\n+                        ->columnSpan(6),\n \n-                        ToggleButtons::make('sales_type')\n-                            ->required()\n-                            ->grouped()\n-                            ->options([\n-                                'dine_in' => 'Dine In',\n-                                'self_pickup' => 'Self Pickup',\n-                                'delivery' => 'Delivery'\n-                            ])\n-                            ->live()\n-                            ->columnSpan(6),\n+                    Select::make('user_id')\n+                        ->label('Supplier')\n+                        ->relationship('user', 'name')\n+                        ->searchable()\n+                        ->preload()\n+                        ->required()\n+                        ->columnSpan(4),\n \n-                        Select::make('currency')\n-                            ->default('idr')\n-                            ->required()\n-                            ->options([\n-                                'idr' => 'IDR',\n-                                'usd' => 'USD',\n-                                'eur' => 'EUR'\n-                            ])\n-                            ->columnSpan(2),\n+                    ToggleButtons::make('sales_type')\n+                        ->required()\n+                        ->grouped()\n+                        ->options([\n+                            'dine_in' => 'Dine In',\n+                            'self_pickup' => 'Self Pickup',\n+                            'delivery' => 'Delivery'\n+                        ])\n+                        ->live()\n+                        ->columnSpan(4),\n \n-                        Toggle::make('is_paid')\n-                            ->required()\n-                            ->label('Paid?')\n-                            ->columnSpan(3),\n+                    Select::make('shipping_method')\n+                        ->options([\n+                            'kurir_taibah' => 'Kurir Taibah',\n+                            'grabfood' => 'GrabFood',\n+                            'gofood' => 'GoFood'\n+                        ])\n+                        ->required(function (Get $get) {\n+                            if ($get('sales_type') == 'delivery') {\n+                                return true;\n+                            } else {\n+                                return false;\n+                            }\n+                        })\n+                        ->columnSpan(4),\n \n-                        ToggleButtons::make('payment_method')\n-                            ->options([\n-                                'cash' => 'Cash',\n-                                'transfer' => 'Transfer',\n-                            ])\n-                            ->required()\n-                            ->grouped()\n-                            ->columnSpan(5),\n+                    ToggleButtons::make('status')\n+                        ->inline()\n+                        ->default('new')\n+                        ->required()\n+                        ->columnSpanFull()\n+                        ->options([\n+                            'new' => 'New',\n+                            'processing' => 'Processing',\n+                            'shipped' => 'Shipped',\n+                            'delivered' => 'Delivered',\n+                            'canceled' => 'Canceled'\n+                        ])\n+                        ->colors([\n+                            'new' => 'info',\n+                            'processing' => 'warning',\n+                            'shipped' => 'gray',\n+                            'delivered' => 'success',\n+                            'canceled' => 'danger'\n+                        ])\n+                        ->icons([\n+                            'new' => 'heroicon-m-sparkles',\n+                            'processing' => 'heroicon-m-arrow-path',\n+                            'shipped' => 'heroicon-m-truck',\n+                            'delivered' => 'heroicon-m-check-badge',\n+                            'canceled' => 'heroicon-m-x-circle'\n+                        ]),\n \n-                        Select::make('shipping_method')\n-                            ->options([\n-                                'kurir_taibah' => 'Kurir Taibah',\n-                                'grabfood' => 'GrabFood',\n-                                'gofood' => 'GoFood'\n-                            ])\n-                            ->required(function (Get $get) {\n-                                if ($get('sales_type') == 'delivery') {\n-                                    return true;\n-                                } else {\n-                                    return false;\n-                                }\n-                            })\n-                            ->columnSpan(4),\n+                    Textarea::make('notes')\n+                        ->autosize()\n+                        ->columnSpanFull()\n+                ])->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12]),\n \n-                        ToggleButtons::make('status')\n-                            ->inline()\n-                            ->default('new')\n-                            ->required()\n-                            ->columnSpanFull()\n-                            ->options([\n-                                'new' => 'New',\n-                                'processing' => 'Processing',\n-                                'shipped' => 'Shipped',\n-                                'delivered' => 'Delivered',\n-                                'canceled' => 'Canceled'\n-                            ])\n-                            ->colors([\n-                                'new' => 'info',\n-                                'processing' => 'warning',\n-                                'shipped' => 'gray',\n-                                'delivered' => 'success',\n-                                'canceled' => 'danger'\n-                            ])\n-                            ->icons([\n-                                'new' => 'heroicon-m-sparkles',\n-                                'processing' => 'heroicon-m-arrow-path',\n-                                'shipped' => 'heroicon-m-truck',\n-                                'delivered' => 'heroicon-m-check-badge',\n-                                'canceled' => 'heroicon-m-x-circle'\n-                            ]),\n+                Section::make('Order Items')->schema([\n+                    Repeater::make('items')\n+                        ->relationship()\n+                        ->reorderable()\n+                        ->schema([\n \n-                        Textarea::make('notes')\n-                            ->autosize()\n-                            ->columnSpanFull()\n-                    ])->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12]),\n+                            Select::make('product_id')\n+                                ->relationship(\n+                                    name: 'product',\n+                                    modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->orderBy('variant')->where('is_active', 1)->where('branch_id', Auth::user()->branch_id),\n+                                )\n+                                ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name} {$record->variant}\")\n+                                ->searchable(['name', 'variant'])\n+                                ->preload()\n+                                ->required()\n+                                ->live()\n+                                ->distinct()\n+                                ->disableOptionsWhenSelectedInSiblingRepeaterItems()\n+                                ->reactive()\n+                                ->afterStateUpdated(fn($state, Set $set) => $set('unit_amount', Product::find($state)?->price ?? 0))\n+                                ->afterStateUpdated(fn($state, Set $set, Get $get) => $set('total_amount', Product::find($state)?->price * $get('quantity') ?? 0))\n+                                ->columnSpan(['sm' => 4, 'md' => 4, 'lg' => 4, 'xl' => 4]),\n \n-                    Section::make('Order Items')->schema([\n-                        Repeater::make('items')\n-                            ->relationship()\n-                            ->reorderable()\n-                            ->schema([\n+                            TextInput::make('quantity')\n+                                ->numeric()\n+                                ->required()\n+                                // ->maxValue(function (Get $get) {\n+                                //     $boughtqty = OrderItem::query()->where('product_id', $get('product_id'))->sum('p_quantity');\n+                                //     $soldqty = OrderItem::query()->where('product_id', $get('product_id'))->sum('quantity');\n+                                //     return $boughtqty - $soldqty;\n+                                // }) #ini untuk membatasi quantity sesuai stok yang ada\n+                                ->minValue(1)\n+                                ->live(onBlur: true) ## ini untuk klik di luar field lalu ada perubahan\n+                                // ->live(debounce: 2000) ## ini untuk delay 2000 milidetik lalu ada perubahan\n+                                ->afterStateUpdated(fn($state, Set $set, Get $get) => $set('total_amount', $state * $get('unit_amount')))\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                                Select::make('product_id')\n-                                    ->relationship(\n-                                        name: 'product',\n-                                        modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->orderBy('variant')->where('is_active', 1)->where('branch_id', Auth::user()->branch_id),\n-                                    )\n-                                    ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name} {$record->variant}\")\n-                                    ->searchable(['name', 'variant'])\n-                                    ->preload()\n-                                    ->required()\n-                                    ->live()\n-                                    ->distinct()\n-                                    ->disableOptionsWhenSelectedInSiblingRepeaterItems()\n-                                    ->reactive()\n-                                    ->columnSpan(['sm' => 4, 'md' => 4, 'lg' => 4, 'xl' => 4]),\n+                            TextInput::make('unit_amount')\n+                                ->label('Amount')\n+                                ->required()\n+                                ->dehydrated()\n+                                ->numeric()\n+                                ->live(onBlur: true)\n+                                ->afterStateUpdated(fn($state, Set $set, Get $get) => $set('total_amount', $state * $get('quantity')))\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                                TextInput::make('p_quantity')\n-                                    ->numeric()\n-                                    ->required()\n-                                    ->default(1)\n-                                    ->minValue(1)\n-                                    ->live(onBlur: true) ## ini untuk klik di luar field lalu ada perubahan\n-                                    // ->live(debounce: 2000) ## ini untuk delay 2000 milidetik lalu ada perubahan\n-                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+                            TextInput::make('total_amount')\n+                                ->label('Total')\n+                                ->required()\n+                                ->disabled()\n+                                ->dehydrated()\n+                                ->numeric()\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                                TextInput::make('p_unit_amount')\n-                                    ->required()\n-                                    ->numeric()\n-                                    ->live(onBlur: true)\n-                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+                            Select::make('branch_id')\n+                                ->default(fn() => Auth::user()->branch_id)\n+                                ->relationship(\n+                                    name: 'branch',\n+                                    modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->where('is_active', 1),\n+                                )\n+                                ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name}\")\n+                                ->disabled()\n+                                ->dehydrated()\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                                TextInput::make('p_total_amount')\n-                                    ->required()\n-                                    ->placeholder(function (Set $set, Get $get) {\n-                                        $namanya = $get('product_id');\n-                                        $qtynya = $get('p_quantity');\n-                                        $pricenya = $get('p_unit_amount');\n-                                        if ($namanya) {\n-                                            $set('p_total_amount', $pricenya * $qtynya);\n-                                        }\n-                                    })\n-                                    ->readOnly()\n-                                    ->numeric()\n-                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+                            Hidden::make('mutation_type')\n+                                ->default('Sales'),\n \n-                                Select::make('branch_id')\n-                                    ->default(fn() => Auth::user()->branch_id)\n-                                    ->relationship(\n-                                        name: 'branch',\n-                                        modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->where('is_active', 1),\n-                                    )\n-                                    ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name}\")\n-                                    ->disabled()\n-                                    ->dehydrated()\n-                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+                        ])\n+                        ->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12])\n+                        ->extraItemActions([\n+                            Action::make('openProduct')\n+                                ->tooltip('Open product')\n+                                ->icon('heroicon-m-arrow-top-right-on-square')\n+                                ->url(function (array $arguments, Repeater $component): ?string {\n+                                    $itemData = $component->getRawItemState($arguments['item']);\n \n-                                Hidden::make('mutation_type')\n-                                    ->default('Purchase'),\n+                                    $product = Product::find($itemData['product_id']);\n \n-                            ])\n-                            ->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12])\n-                            ->extraItemActions([\n-                                Action::make('openProduct')\n-                                    ->tooltip('Open product')\n-                                    ->icon('heroicon-m-arrow-top-right-on-square')\n-                                    ->url(function (array $arguments, Repeater $component): ?string {\n-                                        $itemData = $component->getRawItemState($arguments['item']);\n+                                    if (! $product) {\n+                                        return null;\n+                                    }\n \n-                                        $product = Product::find($itemData['product_id']);\n+                                    return ProductResource::getUrl('edit', ['record' => $product]);\n+                                }, shouldOpenInNewTab: true)\n+                                ->hidden(fn(array $arguments, Repeater $component): bool => blank($component->getRawItemState($arguments['item'])['product_id'])),\n+                        ]),\n \n-                                        if (! $product) {\n-                                            return null;\n-                                        }\n+                    Group::make()->schema([\n \n-                                        return ProductResource::getUrl('edit', ['record' => $product]);\n-                                    }, shouldOpenInNewTab: true)\n-                                    ->hidden(fn(array $arguments, Repeater $component): bool => blank($component->getRawItemState($arguments['item'])['product_id'])),\n-                            ]),\n+                        TextInput::make(name: 'discount')\n+                            ->default(0)\n+                            ->required()\n+                            ->numeric()\n+                            ->live(onBlur: true),\n+                        TextInput::make(name: 'shipping_amount')\n+                            ->default(0)\n+                            ->required()\n+                            ->numeric()\n+                            ->live(onBlur: true),\n \n-                        Group::make()->schema([\n+                        Placeholder::make('grand_total_placeholder')\n+                            ->label('Grand Total')\n+                            ->content(function (Get $get, Set $set) {\n \n-                            TextInput::make(name: 'discount')\n-                                ->default(0)\n+                                $total = 0;\n+                                if (!$repeaters = $get('items')) {\n+                                    return $total;\n+                                }\n+                                foreach ($repeaters as $key => $repeater) {\n+                                    $total += $get(\"items.{$key}.total_amount\");\n+                                }\n+\n+                                $discount = $get('discount');\n+                                if ($discount != null) {\n+                                    $discount = $get('discount');\n+                                } else {\n+                                    $discount = 0;\n+                                }\n+                                $shipping_amount = $get('shipping_amount');\n+                                if ($shipping_amount != null) {\n+                                    $shipping_amount = $get('shipping_amount');\n+                                } else {\n+                                    $shipping_amount = 0;\n+                                }\n+                                $bytambahan = $shipping_amount - $discount;\n+                                $grandTotal = $total + $bytambahan;\n+                                $set('grand_total', $grandTotal);\n+                                return Number::currency($grandTotal, 'IDR');\n+                            }),\n+\n+                        Hidden::make('grand_total')\n+                            ->default(0)\n+\n+                    ])->columns(['sm' => 3, 'md' => 3, 'lg' => 3, 'xl' => 3])\n+                ]),\n+                Section::make('Payments')->schema([\n+                    Repeater::make('payments')\n+                        ->relationship()\n+                        ->reorderable()\n+                        ->schema([\n+\n+                            Hidden::make('created_by')\n+                                ->default(fn() => Auth::user()->id)\n+                                ->required(),\n+\n+                            Hidden::make('updated_by')\n+                                ->default(fn() => Auth::user()->id)\n+                                ->required(),\n+\n+                            DateTimePicker::make('date_payment')\n+                                ->default(now())\n                                 ->required()\n-                                ->numeric()\n-                                ->live(onBlur: true),\n-                            TextInput::make(name: 'shipping_amount')\n-                                ->default(0)\n+                                ->columnSpan(['sm' => 4, 'md' => 4, 'lg' => 4, 'xl' => 4]),\n+\n+                            Select::make('currency')\n+                                ->default('idr')\n                                 ->required()\n+                                ->options([\n+                                    'idr' => 'IDR',\n+                                    'usd' => 'USD',\n+                                    'eur' => 'EUR'\n+                                ])\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+\n+                            ToggleButtons::make('payment_method')\n+                                ->options([\n+                                    'cash' => 'Cash',\n+                                    'transfer' => 'Transfer',\n+                                ])\n+                                ->required()\n+                                ->grouped()\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n+\n+                            TextInput::make('nominal')\n+                                ->label('Nominal')\n+                                ->required()\n                                 ->numeric()\n-                                ->live(onBlur: true),\n+                                ->live(onBlur: true)\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                            Placeholder::make('grand_total_placeholder')\n-                                ->label('Grand Total')\n-                                ->content(function (Get $get, Set $set) {\n+                            Select::make('branch_id')\n+                                ->default(fn() => Auth::user()->branch_id)\n+                                ->relationship(\n+                                    name: 'branch',\n+                                    modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->where('is_active', 1),\n+                                )\n+                                ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name}\")\n+                                ->disabled()\n+                                ->dehydrated()\n+                                ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n \n-                                    $total = 0;\n-                                    if (!$repeaters = $get('items')) {\n-                                        return $total;\n-                                    }\n-                                    foreach ($repeaters as $key => $repeater) {\n-                                        $total += $get(\"items.{$key}.p_total_amount\");\n-                                    }\n+                        ])\n+                        ->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12]),\n \n-                                    $discount = $get('discount');\n-                                    if ($discount != null) {\n-                                        $discount = $get('discount');\n-                                    } else {\n-                                        $discount = 0;\n-                                    }\n-                                    $shipping_amount = $get('shipping_amount');\n-                                    if ($shipping_amount != null) {\n-                                        $shipping_amount = $get('shipping_amount');\n-                                    } else {\n-                                        $shipping_amount = 0;\n-                                    }\n-                                    $bytambahan = $shipping_amount - $discount;\n-                                    $grandTotal = $total + $bytambahan;\n-                                    $set('grand_total', $grandTotal);\n-                                    return Number::currency($grandTotal, 'IDR');\n-                                }),\n+                    Group::make()->schema([\n \n-                            Hidden::make('grand_total')\n-                                ->default(0)\n+                        Placeholder::make('total_cashback_placeholder')\n+                            ->label('Total Cashback')\n+                            ->content(function (Get $get, Set $set) {\n \n-                        ])->columns(['sm' => 3, 'md' => 3, 'lg' => 3, 'xl' => 3])\n-                    ])\n-                ])->columnSpanFull()\n-            ]);\n+                                $subtotal_payment = 0;\n+                                if (!$repeaters = $get('payments')) {\n+                                    return $subtotal_payment;\n+                                }\n+                                foreach ($repeaters as $key => $repeater) {\n+                                    $subtotal_payment += $get(\"payments.{$key}.nominal\");\n+                                }\n+\n+                                $grand_total = $get('grand_total');\n+                                if ($grand_total != null) {\n+                                    $grand_total = $get('grand_total');\n+                                } else {\n+                                    $grand_total = 0;\n+                                }\n+\n+                                $total_cashback = $subtotal_payment - $grand_total;\n+                                if ($total_cashback >= 0) {\n+                                    $set('is_paid', true);\n+                                } else {\n+                                    $set('is_paid', false);\n+                                }\n+                                $set('total_cashback', $total_cashback);\n+                                return Number::currency($total_cashback, 'IDR');\n+                            }),\n+\n+                        Placeholder::make('total_payment_placeholder')\n+                            ->label('Total Payment')\n+                            ->content(function (Get $get, Set $set) {\n+\n+                                $subtotal_payment = 0;\n+                                if (!$repeaters = $get('payments')) {\n+                                    return $subtotal_payment;\n+                                }\n+                                foreach ($repeaters as $key => $repeater) {\n+                                    $subtotal_payment += $get(\"payments.{$key}.nominal\");\n+                                }\n+\n+                                $grand_total = $get('grand_total');\n+                                if ($grand_total != null) {\n+                                    $grand_total = $get('grand_total');\n+                                } else {\n+                                    $grand_total = 0;\n+                                }\n+\n+                                $set('total_payment', $subtotal_payment);\n+                                return Number::currency($subtotal_payment, 'IDR');\n+                            }),\n+\n+                        Toggle::make('is_paid')\n+                            ->required()\n+                            ->label('Paid?')\n+                            ->disabled()\n+                            ->dehydrated(),\n+\n+                        Hidden::make('total_cashback')\n+                            ->default(0),\n+\n+                        Hidden::make('total_payment')\n+                            ->default(0)\n+\n+                    ])->columns(['sm' => 3, 'md' => 3, 'lg' => 3, 'xl' => 3])\n+                ])\n+            ])->columnSpanFull()\n+        ]);\n+\n     }\n \n     public static function table(Table $table): Table\n     {\n"
                },
                {
                    "date": 1732191341441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -435,14 +435,19 @@\n             })\n \n             ->columns([\n \n-                ToggleColumn::make('is_paid')\n+                IconColumn::make('is_paid')\n                     ->label('Paid')\n+                    ->boolean()\n+                    ->trueColor('info')\n+                    ->falseColor('danger')\n+                    ->trueIcon('heroicon-o-check-badge')\n+                    ->falseIcon('heroicon-o-x-mark')\n                     ->sortable(),\n \n                 TextColumn::make('user.name')\n-                    ->label('Supplier')\n+                    ->label('Customer')\n                     ->sortable()\n                     ->searchable(),\n                 // ->searchable(isIndividual:true),\n \n@@ -451,12 +456,8 @@\n                     ->sortable()\n                     ->alignRight()\n                     ->summarize(Sum::make()->numeric(locale: 'nl')->prefix('Rp ')->label('Total')),\n \n-                TextColumn::make('payment_method')\n-                    ->searchable()\n-                    ->sortable(),\n-\n                 SelectColumn::make('status')\n                     ->options([\n                         'new' => 'New',\n                         'processing' => 'Processing',\n@@ -484,8 +485,11 @@\n                     ->searchable()\n                     ->sortable(),\n                 TextColumn::make('address.phone')\n                     ->label('phone')\n+                    ->copyable()\n+                    ->copyMessage('Number phone copied')\n+                    ->copyMessageDuration(1500)\n                     ->searchable()\n                     ->sortable(),\n \n                 TextColumn::make('code_tr')\n@@ -544,37 +548,43 @@\n                 Filter::make('Unpaid')\n                     ->label('Unpaid')\n                     ->query(fn(Builder $query): Builder => $query->where('is_paid', false)->where('status', '!=', 'canceled')),\n             ])\n+\n             ->actions([\n                 ActionGroup::make([\n                     Actions\\ButtonAction::make('print')\n-                        ->url(fn(Porder $record) => route('printid', $record))\n+                        ->url(fn(Order $record) => route('printid', $record))\n                         ->openUrlInNewTab()\n                         ->icon('heroicon-o-printer'),\n+                    // Actions\\ButtonAction::make('phone')\n+                    //     ->openUrlInNewTab()\n+                    //     ->hidden(fn(Order $record): bool => ! $record->exists())\n+                    //     ->url(fn(Order $record) => url(\"https://wa.me/+62{$record->address->phone}\"))\n+                    //     ->icon('heroicon-o-phone'),\n                     ViewAction::make(),\n                     EditAction::make(),\n                     DeleteAction::make()\n                 ])\n             ], position: ActionsPosition::BeforeColumns)\n             ->bulkActions([\n                 Tables\\Actions\\BulkActionGroup::make([\n \n-                    Tables\\Actions\\BulkAction::make(name: 'Paid?')\n-                        ->requiresConfirmation()\n-                        ->color('info')\n-                        ->icon('heroicon-o-credit-card')\n-                        ->action(function (Collection $records, array $data): void {\n-                            foreach ($records as $record) {\n-                                $record->is_paid = $data['is_paid'];\n-                                $record->save();\n-                            }\n-                        })\n-                        ->form([\n-                            Toggle::make('is_paid')\n-                                ->label('Paid ?')\n-                                ->required(),\n-                        ]),\n+                    // Tables\\Actions\\BulkAction::make(name: 'Paid?')\n+                    //     ->requiresConfirmation()\n+                    //     ->color('info')\n+                    //     ->icon('heroicon-o-credit-card')\n+                    //     ->action(function (Collection $records, array $data): void {\n+                    //         foreach ($records as $record) {\n+                    //             $record->is_paid = $data['is_paid'];\n+                    //             $record->save();\n+                    //         }\n+                    //     })\n+                    //     ->form([\n+                    //         Toggle::make('is_paid')\n+                    //             ->label('Paid ?')\n+                    //             ->required(),\n+                    //     ]),\n \n                     Tables\\Actions\\BulkAction::make(name: 'Status')\n                         ->requiresConfirmation()\n                         ->deselectRecordsAfterCompletion()\n"
                },
                {
                    "date": 1732191361821,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -44,8 +44,9 @@\n use Illuminate\\Database\\Eloquent\\Model;\n use Illuminate\\Database\\Eloquent\\SoftDeletingScope;\n use Illuminate\\Support\\Number;\n use Filament\\Pages\\Actions;\n+use Filament\\Tables\\Columns\\IconColumn;\n use Illuminate\\Database\\Eloquent\\Collection;\n use Illuminate\\Support\\Facades\\Auth;\n \n class PorderResource extends Resource\n"
                }
            ],
            "date": 1731221668505,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Filament\\Resources;\n\nuse App\\Filament\\Resources\\PorderResource\\Pages;\nuse App\\Filament\\Resources\\PorderResource\\RelationManagers;\nuse App\\Filament\\Resources\\PorderResource\\RelationManagers\\AddressRelationManager;\nuse App\\Models\\Order;\nuse App\\Models\\OrderItem;\nuse App\\Models\\Porder;\nuse App\\Models\\Product;\nuse App\\Models\\User;\nuse Filament\\Forms;\nuse Filament\\Forms\\Components\\Actions\\Action;\nuse Filament\\Forms\\Components\\DatePicker;\nuse Filament\\Forms\\Components\\DateTimePicker;\nuse Filament\\Forms\\Components\\Group;\nuse Filament\\Forms\\Components\\Hidden;\nuse Filament\\Forms\\Components\\Placeholder;\nuse Filament\\Forms\\Components\\Repeater;\nuse Filament\\Forms\\Components\\Section;\nuse Filament\\Forms\\Components\\Select;\nuse Filament\\Forms\\Components\\Textarea;\nuse Filament\\Forms\\Components\\TextInput;\nuse Filament\\Forms\\Components\\Toggle;\nuse Filament\\Forms\\Components\\ToggleButtons;\nuse Filament\\Forms\\Form;\nuse Filament\\Forms\\Get;\nuse Filament\\Forms\\Set;\nuse Filament\\Resources\\Resource;\nuse Filament\\Tables;\nuse Filament\\Tables\\Actions\\ActionGroup;\nuse Filament\\Tables\\Actions\\DeleteAction;\nuse Filament\\Tables\\Actions\\EditAction;\nuse Filament\\Tables\\Actions\\ViewAction;\nuse Filament\\Tables\\Columns\\SelectColumn;\nuse Filament\\Tables\\Columns\\Summarizers\\Sum;\nuse Filament\\Tables\\Columns\\TextColumn;\nuse Filament\\Tables\\Columns\\ToggleColumn;\nuse Filament\\Tables\\Enums\\ActionsPosition;\nuse Filament\\Tables\\Filters\\Filter;\nuse Filament\\Tables\\Table;\nuse Illuminate\\Database\\Eloquent\\Builder;\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Database\\Eloquent\\SoftDeletingScope;\nuse Illuminate\\Support\\Number;\nuse Filament\\Pages\\Actions;\nuse Illuminate\\Database\\Eloquent\\Collection;\nuse Illuminate\\Support\\Facades\\Auth;\n\nclass PorderResource extends Resource\n{\n    protected static ?string $model = Porder::class;\n\n    protected static ?string $label = 'Purchase Order';\n\n    protected static ?string $navigationIcon = 'heroicon-o-shopping-bag';\n\n    public static function form(Form $form): Form\n    {\n        return $form\n            ->schema([\n                Group::make()->schema([\n                    Section::make('Order Information')->schema([\n\n                        Hidden::make('branch_id')\n                            ->default(fn() => Auth::user()->branch_id)\n                            ->required(),\n\n                        Hidden::make('created_by')\n                            ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n                            // ->disabledOn('edit')\n                            ->required(),\n\n                        Hidden::make('updated_by')\n                            ->default(fn() => Auth::user()->id) ## keperluan untuk memilih user setelah ada auth\n                            ->required(),\n\n                        TextInput::make('code_tr')\n                            ->label('No. Transsaction')\n                            ->default('PUR' . date('YmdHis')) ## Jika ingin menggunakan OrderID otomatis\n                            ->readOnly()\n                            ->columnSpan(6),\n\n                        DateTimePicker::make('date_order')\n                            ->default(now())\n                            ->required()\n                            ->columnSpan(6),\n\n                        Select::make('user_id')\n                            ->label('Supplier')\n                            ->relationship('user', 'name')\n                            ->searchable()\n                            ->preload()\n                            ->required()\n                            ->columnSpan(4),\n\n                        ToggleButtons::make('sales_type')\n                            ->required()\n                            ->grouped()\n                            ->options([\n                                'dine_in' => 'Dine In',\n                                'self_pickup' => 'Self Pickup',\n                                'delivery' => 'Delivery'\n                            ])\n                            ->live()\n                            ->columnSpan(6),\n\n                        Select::make('currency')\n                            ->default('idr')\n                            ->required()\n                            ->options([\n                                'idr' => 'IDR',\n                                'usd' => 'USD',\n                                'eur' => 'EUR'\n                            ])\n                            ->columnSpan(2),\n\n                        Toggle::make('is_paid')\n                            ->required()\n                            ->label('Paid?')\n                            ->columnSpan(3),\n\n                        ToggleButtons::make('payment_method')\n                            ->options([\n                                'cash' => 'Cash',\n                                'transfer' => 'Transfer',\n                            ])\n                            ->required()\n                            ->grouped()\n                            ->columnSpan(5),\n\n                        Select::make('shipping_method')\n                            ->options([\n                                'kurir_taibah' => 'Kurir Taibah',\n                                'grabfood' => 'GrabFood',\n                                'gofood' => 'GoFood'\n                            ])\n                            ->required(function (Get $get) {\n                                if ($get('sales_type') == 'delivery') {\n                                    return true;\n                                } else {\n                                    return false;\n                                }\n                            })\n                            ->columnSpan(4),\n\n                        ToggleButtons::make('status')\n                            ->inline()\n                            ->default('new')\n                            ->required()\n                            ->columnSpanFull()\n                            ->options([\n                                'new' => 'New',\n                                'processing' => 'Processing',\n                                'shipped' => 'Shipped',\n                                'delivered' => 'Delivered',\n                                'canceled' => 'Canceled'\n                            ])\n                            ->colors([\n                                'new' => 'info',\n                                'processing' => 'warning',\n                                'shipped' => 'gray',\n                                'delivered' => 'success',\n                                'canceled' => 'danger'\n                            ])\n                            ->icons([\n                                'new' => 'heroicon-m-sparkles',\n                                'processing' => 'heroicon-m-arrow-path',\n                                'shipped' => 'heroicon-m-truck',\n                                'delivered' => 'heroicon-m-check-badge',\n                                'canceled' => 'heroicon-m-x-circle'\n                            ]),\n\n                        Textarea::make('notes')\n                            ->autosize()\n                            ->columnSpanFull()\n                    ])->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12]),\n\n                    Section::make('Order Items')->schema([\n                        Repeater::make('items')\n                            ->relationship()\n                            ->reorderable()\n                            ->schema([\n\n                                Select::make('product_id')\n                                    ->relationship(\n                                        name: 'product',\n                                        modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->orderBy('variant')->where('is_active', 1)->where('branch_id', Auth::user()->branch_id),\n                                    )\n                                    ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name} {$record->variant}\")\n                                    ->searchable(['name', 'variant'])\n                                    ->preload()\n                                    ->required()\n                                    ->live()\n                                    ->distinct()\n                                    ->disableOptionsWhenSelectedInSiblingRepeaterItems()\n                                    ->reactive()\n                                    ->columnSpan(['sm' => 4, 'md' => 4, 'lg' => 4, 'xl' => 4]),\n\n                                TextInput::make('p_quantity')\n                                    ->numeric()\n                                    ->required()\n                                    ->default(1)\n                                    ->minValue(1)\n                                    ->live(onBlur: true) ## ini untuk klik di luar field lalu ada perubahan\n                                    // ->live(debounce: 2000) ## ini untuk delay 2000 milidetik lalu ada perubahan\n                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n\n                                TextInput::make('p_unit_amount')\n                                    ->required()\n                                    ->numeric()\n                                    ->live(onBlur: true)\n                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n\n                                TextInput::make('p_total_amount')\n                                    ->required()\n                                    ->placeholder(function (Set $set, Get $get) {\n                                        $namanya = $get('product_id');\n                                        $qtynya = $get('p_quantity');\n                                        $pricenya = $get('p_unit_amount');\n                                        if ($namanya) {\n                                            $set('p_total_amount', $pricenya * $qtynya);\n                                        }\n                                    })\n                                    ->readOnly()\n                                    ->numeric()\n                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n\n                                Select::make('branch_id')\n                                    ->default(fn() => Auth::user()->branch_id)\n                                    ->relationship(\n                                        name: 'branch',\n                                        modifyQueryUsing: fn(Builder $query) => $query->orderBy('name')->where('is_active', 1),\n                                    )\n                                    ->getOptionLabelFromRecordUsing(fn(Model $record) => \"{$record->name}\")\n                                    ->disabled()\n                                    ->dehydrated()\n                                    ->columnSpan(['sm' => 2, 'md' => 2, 'lg' => 2, 'xl' => 2]),\n\n                                Hidden::make('mutation_type')\n                                    ->default('Purchase'),\n\n                            ])\n                            ->columns(['sm' => 12, 'md' => 12, 'lg' => 12, 'xl' => 12])\n                            ->extraItemActions([\n                                Action::make('openProduct')\n                                    ->tooltip('Open product')\n                                    ->icon('heroicon-m-arrow-top-right-on-square')\n                                    ->url(function (array $arguments, Repeater $component): ?string {\n                                        $itemData = $component->getRawItemState($arguments['item']);\n\n                                        $product = Product::find($itemData['product_id']);\n\n                                        if (! $product) {\n                                            return null;\n                                        }\n\n                                        return ProductResource::getUrl('edit', ['record' => $product]);\n                                    }, shouldOpenInNewTab: true)\n                                    ->hidden(fn(array $arguments, Repeater $component): bool => blank($component->getRawItemState($arguments['item'])['product_id'])),\n                            ]),\n\n                        Group::make()->schema([\n\n                            TextInput::make(name: 'discount')\n                                ->default(0)\n                                ->required()\n                                ->numeric()\n                                ->live(onBlur: true),\n                            TextInput::make(name: 'shipping_amount')\n                                ->default(0)\n                                ->required()\n                                ->numeric()\n                                ->live(onBlur: true),\n\n                            Placeholder::make('grand_total_placeholder')\n                                ->label('Grand Total')\n                                ->content(function (Get $get, Set $set) {\n\n                                    $total = 0;\n                                    if (!$repeaters = $get('items')) {\n                                        return $total;\n                                    }\n                                    foreach ($repeaters as $key => $repeater) {\n                                        $total += $get(\"items.{$key}.p_total_amount\");\n                                    }\n\n                                    $discount = $get('discount');\n                                    if ($discount != null) {\n                                        $discount = $get('discount');\n                                    } else {\n                                        $discount = 0;\n                                    }\n                                    $shipping_amount = $get('shipping_amount');\n                                    if ($shipping_amount != null) {\n                                        $shipping_amount = $get('shipping_amount');\n                                    } else {\n                                        $shipping_amount = 0;\n                                    }\n                                    $bytambahan = $shipping_amount - $discount;\n                                    $grandTotal = $total + $bytambahan;\n                                    $set('grand_total', $grandTotal);\n                                    return Number::currency($grandTotal, 'IDR');\n                                }),\n\n                            Hidden::make('grand_total')\n                                ->default(0)\n\n                        ])->columns(['sm' => 3, 'md' => 3, 'lg' => 3, 'xl' => 3])\n                    ])\n                ])->columnSpanFull()\n            ]);\n    }\n\n    public static function table(Table $table): Table\n    {\n        return $table\n\n            ->modifyQueryUsing(function (Builder $query) {\n                return $query->addSelect([\n                    'created' => User::query()->select('name')\n                        ->whereColumn('id', 'created_by'),\n                    'updated' => User::query()->select('name')\n                        ->whereColumn('id', 'updated_by'),\n                ]);\n            })\n\n            ->columns([\n\n                ToggleColumn::make('is_paid')\n                    ->label('Paid')\n                    ->sortable(),\n\n                TextColumn::make('user.name')\n                    ->label('Supplier')\n                    ->sortable()\n                    ->searchable(),\n                // ->searchable(isIndividual:true),\n\n                TextColumn::make('grand_total')\n                    ->numeric(locale: 'nl')->prefix('Rp ')\n                    ->sortable()\n                    ->alignRight()\n                    ->summarize(Sum::make()->numeric(locale: 'nl')->prefix('Rp ')->label('Total')),\n\n                TextColumn::make('payment_method')\n                    ->searchable()\n                    ->sortable(),\n\n                SelectColumn::make('status')\n                    ->options([\n                        'new' => 'New',\n                        'processing' => 'Processing',\n                        'shipped' => 'Shipped',\n                        'delivered' => 'Delivered',\n                        'canceled' => 'Canceled'\n                    ])\n                    ->searchable()\n                    ->sortable()\n                    ->selectablePlaceholder(false),\n\n                TextColumn::make('shipping_method')\n                    ->searchable()\n                    ->sortable(),\n\n                TextColumn::make('address.fullname')\n                    ->label('for')\n                    ->sortable(),\n                TextColumn::make('address.phone')\n                    ->label('phone')\n                    ->searchable()\n                    ->sortable(),\n\n                TextColumn::make('code_tr')\n                    ->searchable()\n                    ->sortable(),\n\n                TextColumn::make('date_order')\n                    ->dateTime()\n                    ->sortable()\n                    ->toggleable(isToggledHiddenByDefault: true),\n\n                TextColumn::make('created_at')\n                    ->dateTime()\n                    ->sortable()\n                    ->toggleable(isToggledHiddenByDefault: true),\n\n                TextColumn::make('updated_at')\n                    ->dateTime()\n                    ->sortable()\n                    ->toggleable(isToggledHiddenByDefault: true),\n\n                TextColumn::make('created')\n                    ->label('Created by')\n                    ->sortable()\n                    ->toggleable(isToggledHiddenByDefault: true),\n\n                TextColumn::make('updated')\n                    ->label('Updated by')\n                    ->sortable()\n                    ->toggleable(isToggledHiddenByDefault: true),\n            ])->defaultSort('date_order', 'desc')\n\n            ->filters([\n\n                Filter::make('created_at')\n                    ->form([\n                        DatePicker::make('date_order_from'),\n                        DatePicker::make('date_order_until'),\n                    ])\n                    ->query(function (Builder $query, array $data): Builder {\n                        return $query\n                            ->when(\n                                $data['date_order_from'],\n                                fn(Builder $query, $date): Builder => $query->whereDate('date_order', '>=', $date),\n                            )\n                            ->when(\n                                $data['date_order_until'],\n                                fn(Builder $query, $date): Builder => $query->whereDate('date_order', '<=', $date),\n                            );\n                    }),\n\n                Filter::make('is_paid')\n                    ->label('Paid')\n                    ->query(fn(Builder $query): Builder => $query->where('is_paid', true)),\n\n                Filter::make('Unpaid')\n                    ->label('Unpaid')\n                    ->query(fn(Builder $query): Builder => $query->where('is_paid', false)->where('status', '!=', 'canceled')),\n            ])\n            ->actions([\n                ActionGroup::make([\n                    Actions\\ButtonAction::make('print')\n                        ->url(fn(Porder $record) => route('printid', $record))\n                        ->openUrlInNewTab()\n                        ->icon('heroicon-o-printer'),\n                    ViewAction::make(),\n                    EditAction::make(),\n                    DeleteAction::make()\n                ])\n            ], position: ActionsPosition::BeforeColumns)\n            ->bulkActions([\n                Tables\\Actions\\BulkActionGroup::make([\n\n                    Tables\\Actions\\BulkAction::make(name: 'Paid?')\n                        ->requiresConfirmation()\n                        ->color('info')\n                        ->icon('heroicon-o-credit-card')\n                        ->action(function (Collection $records, array $data): void {\n                            foreach ($records as $record) {\n                                $record->is_paid = $data['is_paid'];\n                                $record->save();\n                            }\n                        })\n                        ->form([\n                            Toggle::make('is_paid')\n                                ->label('Paid ?')\n                                ->required(),\n                        ]),\n\n                    Tables\\Actions\\BulkAction::make(name: 'Status')\n                        ->requiresConfirmation()\n                        ->deselectRecordsAfterCompletion()\n                        ->color('warning')\n                        ->icon('heroicon-o-flag')\n                        ->action(function (Collection $records, array $data): void {\n                            foreach ($records as $record) {\n                                $record->status = $data['status'];\n                                $record->save();\n                            }\n                        })\n                        ->form([\n                            Select::make('status')\n                                ->label('Status')\n                                ->options([\n                                    'new' => 'New',\n                                    'processing' => 'Processing',\n                                    'shipped' => 'Shipped',\n                                    'delivered' => 'Delivered',\n                                    'canceled' => 'Canceled'\n                                ])\n                                ->required(),\n                        ]),\n\n                    Tables\\Actions\\DeleteBulkAction::make(),\n\n                ]),\n            ])\n            ->groups([\n                Tables\\Grouping\\Group::make('date_order')\n                    ->label('Order Date')\n                    ->date()\n                    ->collapsible(),\n            ])\n            ->selectCurrentPageOnly()\n            ->query(function (Porder $query) {\n                if (Auth::user()->id != 1) {\n                    return $query->where('branch_id', Auth::user()->branch_id);\n                } else {\n                    return $query;\n                };\n            });\n    }\n\n    public static function getRelations(): array\n    {\n        return [\n            AddressRelationManager::class\n        ];\n    }\n\n    public static function getNavigationBadge(): ?string\n    {\n        // return static::getModel()::count(); ## jika ingin hitung semua\n        return static::getModel()::query()->where('is_paid', 0)->count();\n    }\n\n    public static function getNavigationBadgeColor(): string|array|null\n    {\n        return static::getModel()::count() > 10 ? 'danger' : 'success';\n    }\n\n    public static function getPages(): array\n    {\n        return [\n            'index' => Pages\\ListPorders::route('/'),\n            'create' => Pages\\CreatePorder::route('/create'),\n            'view' => Pages\\ViewPorder::route('/{record}'),\n            'edit' => Pages\\EditPorder::route('/{record}/edit'),\n        ];\n    }\n}\n"
        }
    ]
}