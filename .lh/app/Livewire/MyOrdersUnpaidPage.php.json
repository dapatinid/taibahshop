{
    "sourceFile": "app/Livewire/MyOrdersUnpaidPage.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1735470818715,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1735471006809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,9 +12,9 @@\n use App\\Models\\Product;\n use Illuminate\\Support\\Carbon;\n use Illuminate\\Support\\Facades\\Auth;\n \n-#[Title('My Orders')]\n+#[Title('My Orders Unpaid')]\n class MyOrdersUnpaidPage extends Component\n {\n     use WithPagination;\n     // protected $paginationTheme = 'bootstrap';\n"
                },
                {
                    "date": 1735471024851,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     public function render()\n     {\n         $isadmin = auth()->user()->is_admin;\n         if ($isadmin == 1) {\n-            $my_orders = Order::where('branch_id', auth()->user()->branch_id)->orderBy('is_paid')->orderBy('date_order', 'desc')->paginate(500);\n+            $my_orders = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 1)->orderBy('date_order', 'desc')->paginate(500);\n         }\n         if ($isadmin == 0) {\n             $my_orders = Order::where('user_id', auth()->id())->latest()->paginate(100);\n         }\n"
                },
                {
                    "date": 1735471055969,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -113,9 +113,9 @@\n             ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n-        return view('livewire.my-orders-page', [\n+        return view('livewire.my-orders-unpaid-page', [\n             'payments' => $payments,\n             'orders' => $my_orders,\n             'my_orders_sum' => $my_orders_sum,\n             'my_orders_sum_cashback' => $my_orders_sum_cashback,\n"
                },
                {
                    "date": 1735471080347,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,9 +85,9 @@\n     public function render()\n     {\n         $isadmin = auth()->user()->is_admin;\n         if ($isadmin == 1) {\n-            $my_orders = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 1)->orderBy('date_order', 'desc')->paginate(500);\n+            $my_orders = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 0)->orderBy('date_order', 'desc')->paginate(500);\n         }\n         if ($isadmin == 0) {\n             $my_orders = Order::where('user_id', auth()->id())->latest()->paginate(100);\n         }\n"
                },
                {
                    "date": 1735471276514,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,17 +101,18 @@\n         $paymenttf = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'transfer')->sum(value('nominal_plus'));\n         $my_orders_sum_cashback = Order::where('is_paid', 1)->where('paid_at', 'like', \"%$today%\")->where('total_payment', '>=', 'grand_total')->sum(value('total_cashback'));\n \n         $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n-            ->where('date_payment', 'like', \"%$today%\")->orderBy('date_payment', 'desc')->get();\n+            // ->where('date_payment', 'like', \"%$today%\")\n+            ->orderBy('date_payment', 'desc')->get();\n \n         $products = Product::all();\n         $orderItems = OrderItem::all();\n         $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n-            ->where('updated_at', 'like', \"%$today%\")\n+            // ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get();\n         $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n-            ->where('updated_at', 'like', \"%$today%\")\n+            // ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n         return view('livewire.my-orders-unpaid-page', [\n"
                },
                {
                    "date": 1735476606975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,18 +101,18 @@\n         $paymenttf = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'transfer')->sum(value('nominal_plus'));\n         $my_orders_sum_cashback = Order::where('is_paid', 1)->where('paid_at', 'like', \"%$today%\")->where('total_payment', '>=', 'grand_total')->sum(value('total_cashback'));\n \n         $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n-            // ->where('date_payment', 'like', \"%$today%\")\n+            ->where('date_payment', 'like', \"%$today%\")\n             ->orderBy('date_payment', 'desc')->get();\n \n         $products = Product::all();\n         $orderItems = OrderItem::all();\n         $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n-            // ->where('updated_at', 'like', \"%$today%\")\n+            ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get();\n         $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n-            // ->where('updated_at', 'like', \"%$today%\")\n+            ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n         return view('livewire.my-orders-unpaid-page', [\n"
                },
                {
                    "date": 1735545652887,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -90,8 +90,9 @@\n         }\n         if ($isadmin == 0) {\n             $my_orders = Order::where('user_id', auth()->id())->latest()->paginate(100);\n         }\n+        $orders_all = Order::all();\n         $my_orders_all = Order::where('user_id', auth()->id());\n         $my_orders_sum = $my_orders_all->sum(value('grand_total'));\n         $today = Carbon::now()->format('Y-m-d');\n         $my_orders_sum_unpaid = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 0)->where('status', '!=', 'canceled')->sum(value('total_cashback'));\n@@ -103,22 +104,25 @@\n \n         $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n             ->where('date_payment', 'like', \"%$today%\")\n             ->orderBy('date_payment', 'desc')->get();\n-\n+ \n         $products = Product::all();\n-        $orderItems = OrderItem::all();\n+        $orderItems = OrderItem::whereNull('deleted_at');\n         $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n+            ->whereNull('deleted_at')\n             ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get();\n         $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n+            ->whereNull('deleted_at')\n             ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n         return view('livewire.my-orders-unpaid-page', [\n             'payments' => $payments,\n             'orders' => $my_orders,\n+            'orders_all' => $orders_all,\n             'my_orders_sum' => $my_orders_sum,\n             'my_orders_sum_cashback' => $my_orders_sum_cashback,\n             'my_orders_sum_unpaid' => $my_orders_sum_unpaid,\n             'my_orders_sum_unpaid_count' => $my_orders_sum_unpaid_count,\n"
                },
                {
                    "date": 1735838307912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,20 +102,20 @@\n         $paymenttf = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'transfer')->sum(value('nominal_plus'));\n         $my_orders_sum_cashback = Order::where('is_paid', 1)->where('paid_at', 'like', \"%$today%\")->where('total_payment', '>=', 'grand_total')->sum(value('total_cashback'));\n \n         $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n-            ->where('date_payment', 'like', \"%$today%\")\n+            // ->where('date_payment', 'like', \"%$today%\")\n             ->orderBy('date_payment', 'desc')->get();\n \n         $products = Product::all();\n         $orderItems = OrderItem::whereNull('deleted_at');\n         $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n             ->whereNull('deleted_at')\n-            ->where('updated_at', 'like', \"%$today%\")\n+            // ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get();\n         $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n             ->whereNull('deleted_at')\n-            ->where('updated_at', 'like', \"%$today%\")\n+            // ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n         return view('livewire.my-orders-unpaid-page', [\n"
                },
                {
                    "date": 1735839317880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -102,20 +102,20 @@\n         $paymenttf = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'transfer')->sum(value('nominal_plus'));\n         $my_orders_sum_cashback = Order::where('is_paid', 1)->where('paid_at', 'like', \"%$today%\")->where('total_payment', '>=', 'grand_total')->sum(value('total_cashback'));\n \n         $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n-            // ->where('date_payment', 'like', \"%$today%\")\n+            ->where('date_payment', 'like', \"%$today%\")\n             ->orderBy('date_payment', 'desc')->get();\n \n         $products = Product::all();\n         $orderItems = OrderItem::whereNull('deleted_at');\n         $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n             ->whereNull('deleted_at')\n-            // ->where('updated_at', 'like', \"%$today%\")\n+            ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get();\n         $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n             ->whereNull('deleted_at')\n-            // ->where('updated_at', 'like', \"%$today%\")\n+            ->where('updated_at', 'like', \"%$today%\")\n             ->orderBy('product_id', 'asc')->get()\n             ->groupBy('product_id');\n \n         return view('livewire.my-orders-unpaid-page', [\n"
                }
            ],
            "date": 1735470818715,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace App\\Livewire;\n\nuse App\\Models\\Order;\nuse App\\Models\\Payment;\nuse Livewire\\Attributes\\Title;\nuse Livewire\\Component;\nuse Livewire\\WithPagination;\nuse App\\Http\\Controllers\\PrintController;\nuse App\\Models\\OrderItem;\nuse App\\Models\\Product;\nuse Illuminate\\Support\\Carbon;\nuse Illuminate\\Support\\Facades\\Auth;\n\n#[Title('My Orders')]\nclass MyOrdersUnpaidPage extends Component\n{\n    use WithPagination;\n    // protected $paginationTheme = 'bootstrap';\n\n    public $id;\n\n    public function changeStatus($id)\n    {\n        if (Auth::check()) {\n            $data = Order::where('id', $id);\n            $statusnow = $data->value('status');\n            if (auth()->user()->is_admin == 1) {\n                if ($statusnow == 'new') {\n                    $update = [\n                        'status' => 'processing',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                if ($statusnow == 'processing') {\n                    $update = [\n                        'status' => 'shipped',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                if ($statusnow == 'shipped') {\n                    $update = [\n                        'status' => 'delivered',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                if ($statusnow == 'delivered') {\n                    $update = [\n                        'status' => 'canceled',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                if ($statusnow == 'canceled') {\n                    $update = [\n                        'status' => 'new',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                $data->update($update);\n            } else {\n                if ($statusnow == 'canceled') {\n                    $update = [\n                        'status' => 'canceled',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                } else {\n                    $update = [\n                        'status' => 'delivered',\n                        'updated_by' => auth()->user()->id,\n                        'updated_at' => date('Y-m-d H:i:s'),\n                    ];\n                }\n                $data->update($update);\n            }\n        }\n    }\n\n    public function render()\n    {\n        $isadmin = auth()->user()->is_admin;\n        if ($isadmin == 1) {\n            $my_orders = Order::where('branch_id', auth()->user()->branch_id)->orderBy('is_paid')->orderBy('date_order', 'desc')->paginate(500);\n        }\n        if ($isadmin == 0) {\n            $my_orders = Order::where('user_id', auth()->id())->latest()->paginate(100);\n        }\n        $my_orders_all = Order::where('user_id', auth()->id());\n        $my_orders_sum = $my_orders_all->sum(value('grand_total'));\n        $today = Carbon::now()->format('Y-m-d');\n        $my_orders_sum_unpaid = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 0)->where('status', '!=', 'canceled')->sum(value('total_cashback'));\n        $my_orders_sum_unpaid_count = Order::where('branch_id', auth()->user()->branch_id)->where('is_paid', 0)->where('status', '!=', 'canceled')->count();\n        $paymentlast = Payment::orderBy('date_payment', 'desc')->get();\n        $paymentcash = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'cash')->sum(value('nominal_plus'));\n        $paymenttf = Payment::where('branch_id', auth()->user()->branch_id)->where('date_payment', 'like', \"%$today%\")->where('payment_method', '=', 'transfer')->sum(value('nominal_plus'));\n        $my_orders_sum_cashback = Order::where('is_paid', 1)->where('paid_at', 'like', \"%$today%\")->where('total_payment', '>=', 'grand_total')->sum(value('total_cashback'));\n\n        $payments = Payment::where('branch_id', auth()->user()->branch_id)->where('order_id', '!=', null)\n            ->where('date_payment', 'like', \"%$today%\")->orderBy('date_payment', 'desc')->get();\n\n        $products = Product::all();\n        $orderItems = OrderItem::all();\n        $itemsSold = OrderItem::where('branch_id', auth()->user()->branch_id)\n            ->where('updated_at', 'like', \"%$today%\")\n            ->orderBy('product_id', 'asc')->get();\n        $itemsSoldGroup = OrderItem::where('branch_id', auth()->user()->branch_id)\n            ->where('updated_at', 'like', \"%$today%\")\n            ->orderBy('product_id', 'asc')->get()\n            ->groupBy('product_id');\n\n        return view('livewire.my-orders-page', [\n            'payments' => $payments,\n            'orders' => $my_orders,\n            'my_orders_sum' => $my_orders_sum,\n            'my_orders_sum_cashback' => $my_orders_sum_cashback,\n            'my_orders_sum_unpaid' => $my_orders_sum_unpaid,\n            'my_orders_sum_unpaid_count' => $my_orders_sum_unpaid_count,\n            'isadmin' => $isadmin,\n            'today' => $today,\n            'paymentlast' => $paymentlast,\n            'paymentcash' => $paymentcash,\n            'paymenttf' => $paymenttf,\n            'products' => $products,\n            'orderItems' => $orderItems,\n            'itemsSold' => $itemsSold,\n            'itemsSoldGroup' => $itemsSoldGroup,\n        ]);\n    }\n}\n"
        }
    ]
}